function dist = gcircdist(p1,p2)%Function dist = gcircdist(p1,p2)%  Finds the great circle distance DIST(p1==>p2) in nautical miles%  between two points [p1,p2] on the globe, where p = [lat,lon].%  The algorithm uses a rotation matrix R2R1 to transform the polar coor-%  dinate system (lat,lon) so that p1 lies at the pole of the transformed%  system. Applying R2R1 to p2 puts it on a meridian of the new system%  such that its colatitude is now the distance between p1 & p2. %%  Written by D.B. Enfield, November, 1995%  NOAA/Atlantic Oceanographic & Meteorological Laboratory%  Miami, FL 33149 (305-361-4351); enfield@aoml.noaa.gov% Initializationsfac = pi/180; p1  = fac*p1; p2  = fac*p2;la1 = p1(1);  la2 = p2(1);  lo1 = p1(2); lo2 = p2(2);% Transform to new systemx2 = [cos(la2)*cos(lo2),cos(la2)*sin(lo2),sin(la2)]'; % Cartesians of p2R2R1 = zeros(3,3);            % Preallocate rotation matrixI1I2 = zeros(3,3);            % Preallocate Inverse rotation matrixR2R1(1,:) = [sin(la1)*cos(lo1),sin(la1)*sin(lo1),-cos(la1)];R2R1(2,:) = [-sin(lo1),cos(lo1),0];R2R1(3,:) = [cos(la1)*cos(lo1),cos(la1)*sin(lo1),sin(la1)];xx2  = R2R1*x2;               % Transform p2phi  = pi/2-asin(xx2(3));     % New colatitude of p2dist = 60*phi/fac;            % Total distance along route (NM)